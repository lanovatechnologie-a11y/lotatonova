<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Lotato – Subsystem Admin</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

    <style>
        :root {
            --primary:#3498db;
            --secondary:#2c3e50;
            --success:#27ae60;
            --warning:#f39c12;
            --danger:#e74c3c;
            --bg:#f5f7fa;
            --sidebar:240px;
        }

        *{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,Tahoma,sans-serif}
        body{background:var(--bg);display:flex;min-height:100vh;color:#2c3e50}

        /* SIDEBAR */
        .sidebar{
            width:var(--sidebar);
            background:linear-gradient(180deg,var(--secondary),#1a2530);
            color:#fff;
            position:fixed;
            height:100vh;
        }
        .logo{
            padding:20px;
            text-align:center;
            border-bottom:1px solid rgba(255,255,255,.1)
        }
        .logo i{font-size:28px;color:var(--primary)}
        .nav a{
            display:flex;
            align-items:center;
            padding:12px 20px;
            color:rgba(255,255,255,.85);
            text-decoration:none;
            cursor:pointer;
        }
        .nav a i{width:22px}
        .nav a.active,
        .nav a:hover{
            background:rgba(255,255,255,.1);
            color:#fff;
            border-left:4px solid var(--primary);
        }

        /* MAIN */
        .main{
            margin-left:var(--sidebar);
            padding:20px;
            width:100%;
        }
        .topbar{
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-bottom:1px solid #ddd;
            padding-bottom:10px;
            margin-bottom:20px;
        }

        /* STATS */
        .stats{
            display:grid;
            grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
            gap:15px;
            margin-bottom:20px;
        }
        .card{
            background:#fff;
            padding:15px;
            border-radius:8px;
            box-shadow:0 2px 8px rgba(0,0,0,.07);
            display:flex;
            align-items:center;
            gap:12px;
        }
        .card i{
            font-size:22px;
            padding:12px;
            border-radius:6px;
            color:#fff;
        }

        /* TABLE */
        .box{
            background:#fff;
            border-radius:8px;
            padding:20px;
            box-shadow:0 2px 8px rgba(0,0,0,.07);
        }
        table{width:100%;border-collapse:collapse}
        th,td{padding:10px;border-bottom:1px solid #eee;font-size:14px}
        th{background:#f8f9fa;text-align:left}
        tr:hover{background:#f5f5f5}

        .badge{
            padding:4px 8px;
            border-radius:10px;
            font-size:12px;
            font-weight:600;
        }
        .ok{background:#d4edda;color:#155724}
        .warn{background:#fff3cd;color:#856404}
        .bad{background:#f8d7da;color:#721c24}

        .actions button{
            border:none;
            background:#eee;
            padding:6px 8px;
            border-radius:4px;
            cursor:pointer;
        }

        /* MODAL */
        .modal{
            display:none;
            position:fixed;
            inset:0;
            background:rgba(0,0,0,.5);
            align-items:center;
            justify-content:center;
            z-index:2000;
        }
        .modal.active{display:flex}
        .modal-box{
            background:#fff;
            width:400px;
            border-radius:8px;
            padding:20px;
        }
        .modal-header{
            display:flex;
            justify-content:space-between;
            margin-bottom:10px;
        }
        .modal-footer{
            text-align:right;
            margin-top:15px;
        }
        .btn{
            padding:8px 14px;
            border:none;
            border-radius:6px;
            font-weight:600;
            cursor:pointer;
        }
        .btn-primary{background:var(--primary);color:#fff}
        .btn-danger{background:var(--danger);color:#fff}
    </style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="logo">
        <i class="fa-solid fa-diagram-project"></i>
        <div>Subsystem</div>
    </div>
    <div class="nav">
        <a class="active" onclick="showSection('dashboard')"><i class="fa fa-chart-line"></i> Dashboard</a>
        <a onclick="showSection('users')"><i class="fa fa-users"></i> Utilisateurs</a>
        <a onclick="showSection('logs')"><i class="fa fa-list"></i> Logs</a>
    </div>
</div>

<!-- MAIN -->
<div class="main">
    <div class="topbar">
        <h2 id="pageTitle">Dashboard</h2>
        <span id="systemStatus" class="badge ok">ONLINE</span>
    </div>

    <!-- DASHBOARD -->
    <section id="dashboard">
        <div class="stats">
            <div class="card"><i class="fa fa-users" style="background:#3498db"></i><div><b id="statUsers">0</b><div>Utilisateurs</div></div></div>
            <div class="card"><i class="fa fa-ticket" style="background:#9b59b6"></i><div><b id="statTickets">0</b><div>Tickets</div></div></div>
            <div class="card"><i class="fa fa-coins" style="background:#27ae60"></i><div><b id="statSales">0</b><div>Ventes</div></div></div>
        </div>
    </section>

    <!-- USERS -->
    <section id="users" style="display:none">
        <div class="box">
            <h3>Utilisateurs</h3>
            <table>
                <thead>
                    <tr><th>Nom</th><th>Rôle</th><th>Statut</th><th>Actions</th></tr>
                </thead>
                <tbody id="usersTable"></tbody>
            </table>
        </div>
    </section>

    <!-- LOGS -->
    <section id="logs" style="display:none">
        <div class="box">
            <h3>Logs système</h3>
            <ul id="logsList"></ul>
        </div>
    </section>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
    <div class="modal-box">
        <div class="modal-header">
            <h3 id="modalTitle"></h3>
            <button onclick="closeModal()">✖</button>
        </div>
        <div id="modalBody"></div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="closeModal()">OK</button>
        </div>
    </div>
</div>

<script>
/* ===============================
   COMMUNICATION BACKEND (CONSERVÉE)
================================ */
const API_BASE = "/api"; // identique au fichier léger

function authHeaders(){
    return {
        "Content-Type":"application/json",
        "Authorization":"Bearer "+localStorage.getItem("token")
    };
}

/* ===============================
   NAVIGATION INTERNE (AJOUTÉE)
================================ */
function showSection(id){
    document.querySelectorAll("section").forEach(s=>s.style.display="none");
    document.getElementById(id).style.display="block";
    document.getElementById("pageTitle").innerText =
        id.charAt(0).toUpperCase()+id.slice(1);
}

/* ===============================
   DASHBOARD STATS
================================ */
async function loadStats(){
    try{
        const r = await fetch(API_BASE+"/stats",{headers:authHeaders()});
        if(!r.ok) throw "err";
        const d = await r.json();
        statUsers.innerText=d.users;
        statTickets.innerText=d.tickets;
        statSales.innerText=d.sales;
    }catch{
        systemStatus.className="badge warn";
        systemStatus.innerText="WARNING";
    }
}

/* ===============================
   USERS
================================ */
async function loadUsers(){
    usersTable.innerHTML="";
    const r = await fetch(API_BASE+"/users",{headers:authHeaders()});
    const users = await r.json();
    users.forEach(u=>{
        usersTable.innerHTML+=`
        <tr>
            <td>${u.name}</td>
            <td>${u.role}</td>
            <td><span class="badge ${u.active?'ok':'bad'}">${u.active?'ACTIF':'BLOQUÉ'}</span></td>
            <td class="actions">
                <button onclick="viewUser('${u.id}')"><i class="fa fa-eye"></i></button>
                <button onclick="deleteUser('${u.id}')"><i class="fa fa-trash"></i></button>
            </td>
        </tr>`;
    });
}

function viewUser(id){
    modalTitle.innerText="Utilisateur";
    modalBody.innerText="ID : "+id;
    modal.classList.add("active");
}

function deleteUser(id){
    modalTitle.innerText="Suppression";
    modalBody.innerText="Suppression utilisateur "+id;
    modal.classList.add("active");
}

/* ===============================
   LOGS
================================ */
async function loadLogs(){
    const r = await fetch(API_BASE+"/logs",{headers:authHeaders()});
    const logs = await r.json();
    logsList.innerHTML="";
    logs.forEach(l=>{
        logsList.innerHTML+=`<li>${l}</li>`;
    });
}

function closeModal(){
    modal.classList.remove("active");
}

/* INIT */
loadStats();
loadUsers();
loadLogs();
</script>

</body>
</html>